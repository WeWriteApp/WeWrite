<!DOCTYPE html>
<html>
<head>
    <title>WeWrite Debug Monitor</title>
    <style>
        body { font-family: monospace; padding: 20px; background: #1a1a1a; color: #fff; }
        .entry { margin: 10px 0; padding: 10px; background: #2a2a2a; border-radius: 5px; }
        .timestamp { color: #888; }
        .component { color: #4CAF50; font-weight: bold; }
        .action { color: #2196F3; }
        .data { color: #FFC107; margin-left: 20px; }
        button { padding: 10px; margin: 5px; background: #4CAF50; color: white; border: none; border-radius: 3px; cursor: pointer; }
        button:hover { background: #45a049; }
        #status { color: #888; margin: 10px 0; }
    </style>
</head>
<body>
    <h1>WeWrite Debug Monitor</h1>
    <button onclick="readDebug()">Read Debug Data</button>
    <button onclick="clearDebug()">Clear Debug Data</button>
    <button onclick="toggleAutoRefresh()">Toggle Auto Refresh</button>
    
    <div id="status">Click "Read Debug Data" to start monitoring</div>
    <div id="output"></div>

    <script>
        let autoRefresh = false;
        let refreshInterval;

        function readDebug() {
            try {
                const debugData = localStorage.getItem('wewrite-debug');
                const lineMode = localStorage.getItem('lineMode');
                
                let html = '<div class="entry"><strong>Current localStorage lineMode:</strong> ' + (lineMode || 'null') + '</div>';
                
                if (debugData) {
                    const parsed = JSON.parse(debugData);
                    html += '<h3>Debug Entries (' + parsed.length + '):</h3>';
                    
                    parsed.reverse().forEach((entry, index) => {
                        html += '<div class="entry">';
                        html += '<span class="timestamp">[' + entry.timestamp + ']</span> ';
                        html += '<span class="component">' + entry.component + '</span> - ';
                        html += '<span class="action">' + (entry.action || 'render') + '</span>';
                        html += '<div class="data">' + JSON.stringify(entry, null, 2) + '</div>';
                        html += '</div>';
                    });
                } else {
                    html += '<div class="entry">No debug data found in localStorage</div>';
                }
                
                document.getElementById('output').innerHTML = html;
                document.getElementById('status').textContent = 'Last updated: ' + new Date().toLocaleTimeString();
            } catch (e) {
                document.getElementById('output').innerHTML = '<div class="entry" style="color: red;">Error reading debug data: ' + e.message + '</div>';
            }
        }

        function clearDebug() {
            localStorage.removeItem('wewrite-debug');
            document.getElementById('output').innerHTML = '<div class="entry">Debug data cleared</div>';
        }

        function toggleAutoRefresh() {
            autoRefresh = !autoRefresh;
            if (autoRefresh) {
                refreshInterval = setInterval(readDebug, 1000);
                document.getElementById('status').textContent = 'Auto refresh enabled (1s interval)';
            } else {
                clearInterval(refreshInterval);
                document.getElementById('status').textContent = 'Auto refresh disabled';
            }
        }

        // Initial read
        readDebug();
    </script>
</body>
</html>
