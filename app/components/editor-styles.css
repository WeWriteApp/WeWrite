/* CENTRALIZED PILL LINK STYLING
 * Single source of truth for pill link styling in WeWrite
 * Ensures consistent appearance between edit and view modes
 */

/* Base link styling for non-pill links */
.editor-link:not(.page-link):not(.user-link):not(.external-link) {
  color: var(--primary);
  text-decoration: none;
  transition: all 0.2s ease;
}

/* Core pill link styles - minimal overrides only for editor-specific needs */
a.page-link,
a.user-link,
a.external-link {
  /* Only override properties that are essential for editor functionality */
  text-decoration: none !important;
  text-indent: 0 !important;
  float: none !important;
  /* All other styling comes from PillStyleContext - DO NOT override padding */
}

/* User link @ symbol */
.user-link::before,
a.user-link::before,
[data-user-id]::before,
a[data-user-id]::before {
  content: '@';
  opacity: 0.7;
  margin-right: 1px;
}

/* Pill text content styling */
.pill-text {
  display: inline !important;
  white-space: nowrap !important;
  width: fit-content !important;
  min-width: fit-content !important;
  max-width: none !important;
  overflow: visible !important;
  text-overflow: clip !important;
  line-height: inherit !important;
  flex: none !important;
  position: relative !important;
  pointer-events: none !important; /* Allow clicks to pass through to parent link */
  visibility: visible !important;
  opacity: 1 !important;
}

/* Paragraph integration */
.paragraph-with-number a,

.paragraph-with-number a.page-link,
.paragraph-with-number a.user-link,
.paragraph-with-number a.external-link {
  text-indent: 0 !important;
  display: inline-flex !important;
  float: none !important;
  vertical-align: top !important; /* Match paragraph number alignment */
  /* DO NOT override padding - let PillStyleContext handle it */
}

/* COMPOUND LINK STYLING - Ensures separate pill appearance */
.compound-link-container {
  display: inline-flex !important;
  align-items: center !important;
  gap: 0.25rem !important; /* Equivalent to gap-1 */
  flex-wrap: nowrap !important;
}

/* Ensure compound link pills maintain separation */
.compound-link-container .page-portion,
.compound-link-container .author-portion {
  display: inline-flex !important;
  align-items: center !important;
  margin: 0 !important;
  flex-shrink: 0 !important;
}

/* Ensure "by" text in compound links is properly styled */
.compound-link-container .text-muted-foreground {
  display: inline !important;
  margin: 0 !important;
  padding: 0 !important;
  flex-shrink: 0 !important;
  white-space: nowrap !important;
}

/* Prevent compound link container from being treated as a single link */
.compound-link-container:hover {
  background: none !important;
  border: none !important;
  box-shadow: none !important;
}

/* PIXEL-PERFECT VIEW/EDIT MODE TRANSITIONS */
/* Eliminates layout shifts with identical dimensions and invisible borders */

/* Unified container styling for both modes - CRITICAL for layout consistency */
.unified-editor,
.page-content,
.editor-content {
  box-sizing: border-box;
  width: 100%;
  max-width: none;
  padding: 0; /* Consistent padding handled by child elements */
  margin: 0;
  /* CRITICAL: Identical typography settings */
  font-size: 1rem;
  line-height: 1.5; /* Changed from 1.6 to match view mode */
  font-family: inherit;
  /* Ensure natural content flow without viewport constraints */
  min-height: auto;
}

/* Base paragraph styling - NORMAL MODE with first child number */
.unified-paragraph,
.editor-content.normal-mode > div {
  /* Normal mode: Block layout, paragraph number as first child */
  display: block;
  margin-bottom: 0.75rem;
  padding: 0.5rem;
  box-sizing: border-box;
  min-height: 2.5rem;
  width: 100%;
  position: relative;

  /* Typography */
  font-size: 1rem;
  line-height: 1.5;
  font-family: inherit;
  letter-spacing: normal;
  word-spacing: normal;

  /* Border - ALWAYS present to prevent layout shifts */
  border: 2px solid transparent;
  border-radius: 0.375rem;

  /* Smooth transitions for mode switching */
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);

  /* Prevent any unexpected layout changes */
  overflow: visible;
  contain: style;
}

/* View mode - invisible borders maintain dimensions */
.unified-paragraph:not(.editing-mode) {
  border-color: transparent; /* Invisible but maintains space */
}

/* Edit mode - visible borders with same dimensions */
.unified-paragraph.editing-mode,
.editor-content:focus .normal-mode > div:focus-within {
  border-color: hsl(var(--primary) / 0.2);
}

.unified-paragraph.editing-mode:hover,
.editor-content.normal-mode > div:hover {
  background-color: hsl(var(--muted) / 0.3);
}

/* Paragraph number styling - first child in paragraph */
.unified-paragraph-number {
  /* Simple inline-block first child */
  display: inline-block;
  width: 1.5rem;
  text-align: right;
  color: var(--muted-foreground);
  font-size: 0.75rem;
  opacity: 0.8;
  user-select: none;
  pointer-events: none;
  line-height: 1.5;
  margin-right: 0.5rem;
  vertical-align: top;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Text content styling - uses full width with hanging indent */
.unified-text-content {
  /* Text content flows naturally with hanging indent */
  display: inline;
  line-height: 1.5;
  word-wrap: break-word;
  overflow-wrap: break-word;
  /* Reset any text-indent that might interfere */
  text-indent: 0;
}

/* Edit mode paragraph numbers are now handled by injected spans - no pseudo-elements needed */



/* Ensure pill links maintain proper styling within unified content */
.unified-text-content a.page-link,
.unified-text-content a.user-link,
.unified-text-content a.external-link,
.editor-content a.page-link,
.editor-content a.user-link,
.editor-content a.external-link {
  line-height: 1.2; /* Restore pill link line-height */
  vertical-align: top; /* Match paragraph number alignment */
  /* Ensure consistent pill styling between view and edit modes */
}

/* Inner content structure - IDENTICAL between modes */
.unified-paragraph .flex {
  display: flex;
  align-items: baseline;
  width: 100%;
}

/* Hover states - consistent between modes */
.unified-paragraph:hover,
.editor-content.normal-mode > div:hover {
  background-color: hsl(var(--muted) / 0.3);
}

/* CRITICAL: Ensure smooth transitions between view and edit modes */
.page-content,
.unified-editor,
.editor-content {
  transition: border-color 0.15s ease-in-out, background-color 0.15s ease-in-out;
  transform: translateZ(0); /* Force hardware acceleration */
  will-change: border-color, background-color;
  /* Prevent layout shifts by avoiding transitions on layout properties */
}

/* Mode transition class for smooth switching between dense and normal modes */
.mode-transition {
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  transform: translateZ(0); /* Force hardware acceleration */
  will-change: display, margin, padding;
  /* Removed border from will-change to prevent glitches */
}

/* Ensure child elements also transition smoothly */
.mode-transition .unified-paragraph,
.mode-transition .unified-paragraph-number,
.mode-transition .unified-text-content {
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Smooth transitions for all paragraph states */
.unified-paragraph {
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important;
  border: 2px solid transparent !important;
}

/* Ensure smooth transitions work in view mode */
.mode-transition .unified-paragraph {
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important;
}

/* Prevent any layout shifts during mode transitions */
.page-editor-stable {
  /* Reduce containment to prevent interference with dynamic content */
  contain: style;
  /* Ensure consistent dimensions */
  box-sizing: border-box;
  width: 100%;
  /* Natural content flow without viewport constraints */
  min-height: auto;
}

/* CRITICAL FIX: Editor paragraph numbering - COMPLETELY DISABLED CSS APPROACH */
/* Using JavaScript overlay instead for bulletproof protection */

/* Initialize editor container - IDENTICAL for both view and edit modes */
.editor-content.normal-mode {
  position: relative;
  /* CRITICAL: Match container styling with view mode */
  box-sizing: border-box;
  width: 100%;
  max-width: none;
  padding: 0;
  margin: 0;
  font-size: 1rem;
  line-height: 1.5; /* Match view mode exactly */
  font-family: inherit;

  /* No container padding needed - each paragraph handles its own layout with flexbox */
}

/* Style each paragraph div in normal mode - IDENTICAL to unified-paragraph */
.editor-content.normal-mode > div,
.editor-content.normal-mode > .paragraph-div {
  /* CRITICAL: These properties must match .unified-paragraph exactly */
  position: relative;
  margin-bottom: 0.75rem;
  padding: 0.5rem;
  box-sizing: border-box;
  min-height: 2.5rem;
  width: 100%;

  font-size: 1rem;
  line-height: 1.5; /* CRITICAL: Must match view mode */
  border: 2px solid transparent;
  border-radius: 0.375rem;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);

  /* Block layout for normal mode */
  display: block;

  font-family: inherit;
  letter-spacing: normal;
  word-spacing: normal;
}

/* CRITICAL: Completely disable all CSS pseudo-element numbering */
.editor-content.normal-mode > div::before,
.editor-content.normal-mode > div::after {
  display: none !important;
  content: none !important;
}

/* Dense mode - continuous inline text flow */
.unified-paragraph.dense-mode,
.editor-content.dense-mode > div {
  /* Dense mode: Inline layout, paragraphs flow horizontally */
  display: inline !important;
  margin-bottom: 0 !important;
  margin-right: 0 !important;
  padding: 0 !important;
  border: none !important;
  min-height: auto !important;
  width: auto !important;
  box-sizing: border-box;
  vertical-align: baseline;

  /* Smooth transitions for mode switching */
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

/* REMOVED: Visual separator between paragraphs in dense mode for clean appearance */
/* Dense mode should have no visual separators for minimal, clean spacing */

/* Focus and hover states - IDENTICAL to view mode */
.editor-content.normal-mode > div:hover,
.unified-paragraph:hover {
  background-color: hsl(var(--muted) / 0.3);
}

/* Default editor focus state - blue when title is not focused */
.editor-content:focus .normal-mode > div:focus-within,
.unified-paragraph.editing-mode {
  border-color: hsl(var(--primary) / 0.2);
}

/* Coordinated focus states - grey when title is focused */
.title-focused .editor-content:focus .normal-mode > div:focus-within,
.title-focused .unified-paragraph.editing-mode {
  border-color: hsl(var(--muted-foreground) / 0.2) !important;
}

/* Editor focus ring coordination */
.editor-content:focus-within {
  outline: 2px solid hsl(var(--primary) / 0.2);
  outline-offset: 2px;
}

.title-focused .editor-content:focus-within {
  outline: 2px solid hsl(var(--muted-foreground) / 0.2) !important;
}

/* Dense mode container - allow text to wrap naturally */
.dense-mode {
  line-height: 1.6 !important; /* Slightly increased line height for readability */
}

/* Dense mode styling - maintains consistency between view and edit modes */
[contenteditable].dense-mode .unified-paragraph,
.dense-mode .unified-paragraph {
  display: inline-block;
  margin-bottom: 0;
  margin-right: 0.5rem;
  padding: 0.25rem 0;
  border: none;
  min-height: auto;
  position: relative; /* Maintain positioning context */
  vertical-align: top;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

[contenteditable].dense-mode .unified-paragraph-number,
.dense-mode .unified-paragraph-number,
.unified-paragraph.dense-mode .unified-paragraph-number {
  display: inline !important;
  position: relative !important; /* Override absolute positioning in dense mode */
  left: auto !important;
  top: auto !important;
  width: auto !important;
  text-align: left !important;
  margin-right: 0.25rem !important;
  margin-left: 0 !important; /* Remove left margin for first element */
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  font-weight: 500; /* Slightly bolder for better visibility */
}

/* Dense mode paragraph numbering - handled by JavaScript components, not CSS */
/* CSS counters removed to prevent conflicts with JavaScript-based numbering */
.editor-content.dense-mode {
  /* No CSS counter needed - paragraph numbers handled by components */
}

/* Dense mode spacing - add minimal space between paragraphs without visual separators */
.editor-content.dense-mode > div:not(:last-child),
.unified-paragraph.dense-mode:not(:last-child) {
  margin-right: 0.5rem; /* Small space between paragraphs */
}

/* Dense mode content wrapper - allows natural text wrapping */
.dense-content-wrapper {
  line-height: 1.6;
  font-size: 1rem;
  word-wrap: break-word;
  overflow-wrap: break-word;
  hyphens: auto;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  opacity: 1;
  transform: translateY(0);
}

/* Animation for dense mode appearance */
.dense-content-wrapper.mode-transition {
  animation: fadeInUp 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

@keyframes fadeInUp {
  from {
    opacity: 0;
    transform: translateY(10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

/* Dense mode paragraph numbers - inline with content */
.dense-paragraph-number {
  color: var(--muted-foreground);
  font-size: 0.75rem;
  opacity: 0.8;
  margin-right: 0.25rem;
  margin-left: 0.5rem;
  pointer-events: none;
  user-select: none;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  font-weight: 500;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

/* First paragraph number has no left margin */
.dense-paragraph-number:first-child {
  margin-left: 0;
}

/* Dense mode paragraph content - flows naturally */
.dense-paragraph-content {
  display: inline;
  line-height: inherit;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Dense mode paragraph separator - minimal space */
.dense-paragraph-separator {
  margin: 0 0.25rem;
}

/* Paragraph numbering is now handled by injected spans in both view and edit modes */

/* CRITICAL FIX: Ensure links are completely non-editable in the editor */
/* This prevents users from editing link content directly in the editor */
[contenteditable] .page-link,
[contenteditable] .user-link,
[contenteditable] .external-link,
[contenteditable] .compound-link {
  /* Make links completely non-editable */
  -webkit-user-select: none !important;
  -moz-user-select: none !important;
  -ms-user-select: none !important;
  user-select: none !important;

  /* Prevent text cursor */
  cursor: pointer !important;

  /* Ensure contenteditable is disabled */
  -webkit-user-modify: read-only !important;

  /* Prevent focus */
  outline: none !important;

  /* Visual indication that it's clickable but not editable */
  position: relative;
}

/* Ensure nested elements in compound links are also non-editable */
[contenteditable] .compound-link *,
[contenteditable] .page-link *,
[contenteditable] .user-link *,
[contenteditable] .external-link * {
  -webkit-user-select: none !important;
  -moz-user-select: none !important;
  -ms-user-select: none !important;
  user-select: none !important;
  cursor: pointer !important;
  -webkit-user-modify: read-only !important;
}

/* Prevent any text selection or editing within links */
[contenteditable] .page-link::selection,
[contenteditable] .user-link::selection,
[contenteditable] .external-link::selection,
[contenteditable] .compound-link::selection {
  background: transparent !important;
}

/* Ensure links don't interfere with normal text editing around them */
[contenteditable] .page-link + *,
[contenteditable] .user-link + *,
[contenteditable] .external-link + *,
[contenteditable] .compound-link + * {
  -webkit-user-select: text;
  -moz-user-select: text;
  -ms-user-select: text;
  user-select: text;
}