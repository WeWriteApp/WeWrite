#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "ğŸ” Running pre-commit dependency checks..."

# Check for import organization
echo "ğŸ“‹ Checking import organization..."
npm run organize:imports:dry || {
  echo "âš ï¸  Imports need organization. Run: npm run organize:imports"
}

# Run dependency validation
echo "ğŸ”— Validating imports..."
npm run deps:validate || {
  echo "âŒ Import validation failed. Run: npm run deps:fix"
  exit 1
}

# Check for circular dependencies
echo "ğŸ”„ Checking for circular dependencies..."
npm run deps:check | grep -q "CIRCULAR DEPENDENCIES" && {
  echo "âš ï¸  Circular dependencies detected. Please review and refactor."
}

# Run linting
echo "ğŸ§¹ Running ESLint..."
npm run lint || {
  echo "âŒ Linting failed. Run: npm run lint --fix"
  exit 1
}

# Run type checking
echo "ğŸ” Type checking..."
npx tsc --noEmit || {
  echo "âŒ TypeScript compilation failed. Fix type errors."
  exit 1
}

# Check for outdated dependencies (warning only)
echo "ğŸ“¦ Checking for outdated dependencies..."
npm outdated || {
  echo "âš ï¸  Some dependencies are outdated. Consider running: npm run deps:update:dry"
}

echo "âœ… Pre-commit checks passed!"
